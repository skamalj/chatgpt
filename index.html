<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NLP to SQL</title>

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css">

  <!-- BootstrapVue CSS -->
  <link rel="stylesheet" href="https://unpkg.com/bootstrap-vue@2.21.2/dist/bootstrap-vue.min.css">

  <!-- Vue.js -->
  <script src="https://unpkg.com/vue@2.6.14/dist/vue.min.js"></script>

  <!-- BootstrapVue Bundle -->
  <script src="https://unpkg.com/bootstrap-vue@2.21.2/dist/bootstrap-vue.min.js"></script>
</head>

<body>
  <div id="app" class="container mt-5">
    <h1 class="mb-4">NLP to SQL</h1>
    <div id="query-component">
      <div class="form-group">
        <input id="nlp-query" type="text" class="form-control" v-model="nlpQuery" placeholder="Enter NLP Query" @keydown.enter="sendQuery">
      </div>

      <div class="form-group row">
        <label for="temperature" class="col-form-label col-md-2 mb-0" style="color: blue; font-family: Helvetica;">Set Temperature</label>
        <div class="col-md-3">
          <input id="temperature" type="number" class="form-control" v-model="temperature" placeholder="Enter Temperature" min="0" max="1" step="0.1">
        </div>
        <label for="model" class="col-form-label col-md-2 mb-0" style="color: blue; font-family: Helvetica;">Select Model</label>
        <div class="col-md-3">
          <label class="radio-inline">
            <input type="radio" v-model="selectedModel" value="text-davinci-003">text-davinci-003
          </label>
          <label class="radio-inline">
            <input type="radio" v-model="selectedModel" value="gpt-3.5-turbo">gpt-3.5-turbo
          </label>
        </div>
      </div>
      
      <!--
      <div class="form-group">
        <b-button @click="sendQuery" variant="primary">Send Query</b-button>
      </div>
      -->

      <hr>
      <b-container>
      <b-row>
      <b-col cols="4">
      <div v-if="sqlQuery" class="form-group">
        <b-form-textarea id="sql-query" class="form-control" v-model="sqlQuery" rows="11" cols="50"></b-form-textarea>
      </div>
      <div v-if="sqlQuery" class="form-group">
        <b-button @click="sendSQLQuery" variant="secondary" class="mt-2">Execute SQL</b-button>
      </div>
      </b-col>

      <b-col cols="8">
      <div v-if="queryResult">
        <table class="table">
          <thead>
            <tr>
              <th v-for="(value, column) in queryResult[0]" :key="column">{{ column }}</th>
            </tr>
          </thead>
          <tbody>
            <tr v-for="record in queryResult" :key="record">
              <td v-for="(value, column) in record" :key="column">{{ value }}</td>
            </tr>
          </tbody>
        </table>
      </div>
      </b-col>
      </b-row>
      </b-container>

    </div>
  </div>

  <script>
    new Vue({
      el: '#app',
      data() {
        return {
          nlpQuery: '',
          sqlQuery: '',
          queryResult: null,
          temperature: 0.3,
          selectedModel: 'text-davinci-003'
        };
      },
      methods: {
        async sendQuery() {
          try {
            fetch('http://localhost:3000/generate-response', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json'
              },
              body: JSON.stringify({ query: this.nlpQuery, temp: Number(this.temperature), model: this.selectedModel })
            })
            .then(response => response.json())
            .then(data => this.sqlQuery = data.sql);

          } catch (error) {
            this.sqlQuery = 'Error occurred while executing the query.' + JSON.stringify(error);
          }
        },
        async sendSQLQuery() {
          try {
            fetch('http://localhost:3000/bigquery-query', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json'
              },
              body: JSON.stringify({ sql: this.sqlQuery })
            })
            .then(response => response.json())
            .then(data => this.queryResult = data.records);

          } catch (error) {
            this.queryResult = null;
            console.error(error);
          }
        }
      }
    });
  </script>
</body>

</html>
